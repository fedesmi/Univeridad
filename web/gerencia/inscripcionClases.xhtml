<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    template="gerenteIndex.xhtml"
    xmlns:p="http://primefaces.org/ui">

    <ui:define name="source">
        <h:form id="formInscripcion">
            <h:outputScript library="js" name="calendar_es.js"  />
            <p:growl id="msgs" showDetail="true" />

            <p:outputLabel value="Inscripcion a Clases" />
            <br/>



            <p:calendar style="font-size: 10px;"   pages="4"   mindate="#{now}" mode="inline"  beforeShowDay="domingoDisabled" locale="es" pattern="dd-MM-yyyy" value="#{claseBean.fechaConsulta}" >
                <p:ajax event="dateSelect" listener="#{claseBean.actualizarDisponibilidad()}" update="formGer:formInscripcion:tablaDisponiblidad" />
            </p:calendar>

            <p:dataTable  id="tablaDisponiblidad" widgetVar="disponibilidadWidget" var="dis" 
                          value="#{claseBean.disponibilidadHorariaPorFecha}"
                          style="  border-style: solid; font-weight: 500;  color:slategrey;  border-color: #dbdbdb; border-width: thin; font-size: 14px; color: darkgray; text-align: center;"
                          emptyMessage="sin registros"

                          >

                <f:facet name="header">
                    <p:outputLabel value="#{claseBean.fechaConsultaFormato}" />
                </f:facet>

                <p:column  headerText="Hora inicio">
                    <h:outputText value="#{dis.horario.inicio}" >
                        <f:convertDateTime pattern="HH:mm" />
                    </h:outputText>
                </p:column>
                <p:column  headerText="Hora fin">
                    <h:outputText value="#{dis.horario.fin}"  >
                        <f:convertDateTime pattern="HH:mm" />
                    </h:outputText>
                </p:column>
                <p:column width="80px;" headerText="Vacantes" styleClass="#{dis.cantidadInstructores-dis.cantidadOcupado>0?'highlightTableRowGreen':'highlightTableRow'}">
                    <h:outputText value="#{dis.cantidadInstructores-dis.cantidadOcupado}" />
                </p:column>

                <p:column width="80px;" headerText="Inscribir">
                    
                    <p:commandButton style="font-weight: bold;" update="formGer:formInscripcion:tablaDisponiblidad"  disabled="#{dis.cantidadInstructores-dis.cantidadOcupado==0}" icon="ui-icon-pencil" ajax="true"   oncomplete="PF('inscribirW').show();" >
                        <f:setPropertyActionListener value="#{dis}" target="#{claseBean.horarioSeleccionado}" />
                    </p:commandButton>
                </p:column>

            </p:dataTable> 


            <p:dialog id="inscribirDlg" header="Inscribir alumno" widgetVar="inscribirW" modal="false"
                      resizable="false" height="170" width="400" style="font-size: 12px;">
                <p:outputPanel id="inscribirAlumnos" >
                    
                    <p:outputLabel value="horario #{claseBean.horarioSeleccionado.horario.inicio.hours}" />
                    <p:panelGrid columns="2" >
                    <p:outputLabel value="Elegir Instructor"  />
                    <p:selectOneMenu style="width:160px" value="#{claseBean.instructor}" filter="true" filterMatchMode="contains" converter="omnifaces.SelectItemsConverter"> >
                        <f:selectItems value="#{claseBean.instructores}" var="inst" itemLabel="#{inst.nombre} #{inst.apellido}" itemValue="#{inst}" />
                    </p:selectOneMenu>
                    <p:outputLabel value="Elegir Alumno"  />
                    <p:selectOneMenu style="width:160px" value="#{claseBean.alumno}" filter="true" filterMatchMode="contains" converter="omnifaces.SelectItemsConverter">>
                        <f:selectItems value="#{claseBean.alumnos}" var="alu" itemLabel="#{alu.nombre} #{alu.apellido}" itemValue="#{alu}" />
                    </p:selectOneMenu>
                    </p:panelGrid>
                    <div style="text-align: right;">
                        <p:commandButton   ajax="false"  value="Guardar Clase" actionListener="#{claseBean.crearClase()}"   />
                    </div>
                </p:outputPanel>
            </p:dialog>


            <script type="text/javascript">
                //<![CDATA[
                function domingoDisabled(date)
                {
                    var day = date.getDay();
                    return [(day != 0), '']
                }
                //]]>
            </script> 
        </h:form> 
    </ui:define>



</ui:composition>