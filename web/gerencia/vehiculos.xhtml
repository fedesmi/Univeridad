<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    template="gerenteIndex.xhtml"
    xmlns:p="http://primefaces.org/ui"> 

    <ui:define name="source"  id="define1">
        <h:form id="form1">
            <h:outputStylesheet library="css" name="cssweb.css" />
            <p:growl id="msgs" showDetail="true" />
            <p:outputLabel value="Vehiculos" />

            <br/>

            <p:dataTable id="tablaVehiculos" widgetVar="vehiculosWidget" var="veh"
                         editable="true"  value="#{vehiculoBean.vehiculos}"  paginator="true" rows="8"
                         emptyMessage="sin registros"
                         rowStyleClass="#{veh.apto==1?'highlightTableRow':''}">

                <f:facet name="header">
                    Lista de Vehiculos
                </f:facet>
                <p:ajax event="rowEditInit"   oncomplete="$('.ui-row-editor span.ui-icon-pencil').each(function(){$(this).css('visibility','hidden')});" />
                <p:ajax event="rowEdit" listener="#{vehiculoBean.onRowEdit}" update="formGer:form1:msgs" oncomplete="PF('vehiculosWidget').filter()" onstart="$('.ui-row-editor span.ui-icon-pencil').each(function(){$(this).css('visibility','visible')});"/>
                <p:ajax event="rowEditCancel" listener="#{vehiculoBean.onRowCancel}" update="formGer:form1:msgs" onstart="$('.ui-row-editor span.ui-icon-pencil').each(function(){$(this).css('visibility','visible')});" />

                <p:column   headerText="Patente" style="text-align: center;" >
                    <div style="text-align: center; font-size: 14px;" >
                        <p:cellEditor>
                            <f:facet name="output"> <h:outputText value="#{veh.patente}" /></f:facet>
                            <f:facet name="input"><p:inputText value="#{veh.patente}" /></f:facet>
                        </p:cellEditor>

                    </div>
                </p:column>
                <p:column  headerText="Marca">
                    <div style="text-align: center; font-size: 14px;" >
                        <p:cellEditor>
                            <f:facet name="output"> <h:outputText value="#{veh.marca}" /></f:facet>
                            <f:facet name="input"><p:inputText value="#{veh.marca}" /></f:facet>
                        </p:cellEditor>
                    </div>
                </p:column>
                <p:column headerText="Modelo" >
                    <div style="text-align: center; font-size: 14px;" >
                        <p:cellEditor>
                            <f:facet name="output"> <h:outputText value="#{veh.modelo}" /></f:facet>
                            <f:facet name="input"><p:inputText value="#{veh.modelo}" /></f:facet>
                        </p:cellEditor>
                    </div>
                </p:column>
                <p:column  headerText="Chasis" >
                    <div style="text-align: center; font-size: 14px;" >
                        <p:cellEditor>
                            <f:facet name="output"> <h:outputText value="#{veh.numeroChasis}" /></f:facet>
                            <f:facet name="input"><p:inputText value="#{veh.numeroChasis}" /></f:facet>
                        </p:cellEditor>
                    </div>
                </p:column>
                <p:column  headerText="Motor" >
                    <div style="text-align: center; font-size: 14px;" >
                        <p:cellEditor>
                            <f:facet name="output"> <h:outputText value="#{veh.numeroMotor}" /></f:facet>
                            <f:facet name="input"><p:inputText value="#{veh.numeroMotor}" /></f:facet>
                        </p:cellEditor>
                    </div>
                </p:column>  
                <p:column  headerText="Año" >
                    <div style="text-align: center; font-size: 14px;" >
                        <p:cellEditor>
                            <f:facet name="output"> <h:outputText value="#{veh.year}" /></f:facet>
                            <f:facet name="input"><p:inputText value="#{veh.year}" /></f:facet>
                        </p:cellEditor>
                    </div>
                </p:column>  
                <p:column  headerText="Apto" >
                    <div style="text-align: center; font-size: 14px;" >
                        <p:cellEditor>
                            <f:facet name="output"> <h:outputText value="#{veh.apto==0 ? 'SI' : 'NO'}" /></f:facet>
                            <f:facet name="input">
                                <p:selectOneMenu id="console" value="#{veh.apto}">
                                    <f:selectItem itemLabel="SI" itemValue="0" />
                                    <f:selectItem itemLabel="NO" itemValue="1" />
                                </p:selectOneMenu>
                            </f:facet>
                        </p:cellEditor>
                    </div>
                </p:column>
                <p:column style="width:40px"  headerText="Mant. y Desp.">
                    <p:commandButton icon="ui-icon-search" ajax="true" update="formGer:form1:detail" oncomplete="PF('dlgDesperfecto').show();">
                        <f:setPropertyActionListener value="#{veh}" target="#{vehiculoBean.vehiculoSelected}" />
                    </p:commandButton>

                </p:column>
                <p:column style="width:32px">
                    <p:rowEditor />
                </p:column>

            </p:dataTable>




            <p:dialog header="Mantenimientos y Desperfectos"  
                      widgetVar="dlgDesperfecto" modal="false" resizable="false" height="300" width="850" style="font-size: 12px;">

                <p:outputPanel id="detail" >
                    <p:panelGrid columns="6" >
                        <h:outputText value="Marca: " />
                        <h:outputText value="#{vehiculoBean.vehiculoSelected.marca}" />
                        <h:outputText value="Modelo: " />
                        <h:outputText value="#{vehiculoBean.vehiculoSelected.modelo}" />
                        <h:outputText value="Patente: " />
                        <h:outputText value="#{vehiculoBean.vehiculoSelected.patente}" />

                    </p:panelGrid>

                    <h:panelGrid columns="2" border="0" >
                        <p:panel style="border-style: none; height: 200px;">
                            <div style="text-align: right;">
                                <p:commandButton icon="ui-icon-plus" ajax="true"   oncomplete="PF('dlgAgregarD').show();" />
                            </div>

                            <p:dataTable id="tablaDesperfectos" widgetVar="desperfectosWidget" var="des"
                                         value="#{desperfectosBean.getDesperfectosDeVehiculo(vehiculoBean.vehiculoSelected.id)}"
                                         scrollable="true" scrollHeight="150" style="border-style: solid; border-color: #dbdbdb; border-width: thin;"
                                         emptyMessage="sin registros"      >

                                <f:facet name="header">
                                    Desperfectos

                                </f:facet>

                                <p:column  headerText="Fecha">
                                    <h:outputText value="#{des.fecha}" >
                                        <f:convertDateTime pattern="dd/MM/yyyy" />
                                    </h:outputText>
                                </p:column>

                                <p:column  headerText="Descripción">
                                    <h:outputText value="#{des.descripcion}" />
                                </p:column>

                            </p:dataTable> 
                        </p:panel>

                        <p:panel style="border-style: none; height: 200px; width: 450px;">
                            <div style="text-align: right;">
                                <p:commandButton icon="ui-icon-plus" ajax="true"  oncomplete="PF('dlgAgregarM').show();" />
                            </div>
                            <p:dataTable id="tablaMantenimientos" widgetVar="mantenimientosWidget" var="man"
                                         value="#{mantenimientosBean.getMantenimientosDeVehiculo(vehiculoBean.vehiculoSelected.id)}"  rows="8"
                                         scrollable="true" scrollHeight="150" style="border-style: solid; border-color: #dbdbdb; border-width: thin;"
                                         emptyMessage="sin registros">

                                <f:facet name="header">
                                    Mantenimientos
                                </f:facet>

                                <p:column  headerText="Fecha">
                                    <h:outputText value="#{man.fecha}" >
                                        <f:convertDateTime pattern="dd/MM/yyyy" />
                                    </h:outputText>
                                </p:column>

                                <p:column  headerText="Lugar">
                                    <h:outputText value="#{man.lugar}" />
                                </p:column>

                                <p:column  headerText="Valor">
                                    <h:outputText value="#{man.valor}" >
                                        <f:convertNumber type="currency" currencySymbol="$" />
                                    </h:outputText>
                                </p:column>

                                <p:column  headerText="Factura">
                                    <h:outputText value="#{man.factura}" />
                                </p:column>
                            </p:dataTable>
                        </p:panel>





                        <p:dialog id="dlgAgregarID" header="Nuevo registro de desperfecto"  
                                  widgetVar="dlgAgregarD" modal="false" resizable="false" height="170" width="400" style="font-size: 12px;">

                            <p:outputPanel id="abmDesperfectos" >
                                <p:outputLabel value="Descripcion"  />
                                <br/>
                                <br/>
                                <div style="text-align: right;">
                                <p:inputTextarea autoResize="true" cols="50" rows="5" maxlength="255"  value="#{desperfectosBean.desperfectoVar.descripcion}" />
                                </div>
                                <br/>
                                <input type="text" hidden="true" id="propiedadVal" name="propiedadVal" value="#{vehiculoBean.vehiculoSelected.id}"  />
                                <br/>
                                <div style="text-align: right;">
                                <p:commandButton   ajax="false"  value="Guardar"   action="#{desperfectosBean.guardar()}" />
                                </div>
                            </p:outputPanel>

                        </p:dialog>

                        <p:dialog header="Nuevo registro de mantenimiento"  
                                  widgetVar="dlgAgregarM" modal="false" resizable="false" height="200" width="400" style="font-size: 12px;">
                            <p:outputPanel id="abmMantenimientos" style="text-align:center;">
                            </p:outputPanel>
                        </p:dialog>

                    </h:panelGrid>


                </p:outputPanel>
            </p:dialog>
        </h:form>
    </ui:define>


</ui:composition>