<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    template="gerenteIndex.xhtml"
    xmlns:p="http://primefaces.org/ui"> 

    <ui:define name="source"  id="defineMantenimientos">
        <h:form id="formMantenimientos">
            <f:metadata>
                <f:viewAction action="#{mantenimientosBean.onLoadMantenimientos()}" />
            </f:metadata>
            <h:outputStylesheet library="css" name="cssweb.css" />
            <p:growl id="msgs" showDetail="true" />
            <p:outputLabel value="Mantenimientos" />

            <br/>


            <p:dataTable id="tablaMantenimientos" widgetVar="mantenimientosWidget" var="man"
                         value="#{mantenimientosBean.mantenimientos}" 
                         scrollable="true" scrollHeight="300" style="border-style: solid; border-color: #dbdbdb; border-width: thin; font-size: 14px;"
                         selectionMode="single" selection="#{mantenimientosBean.mantenimientoSelected}"  rowKey="#{man.id}"
                         emptyMessage="sin registros" >
                <f:facet name="header">
                    Lista de Mantenimientos
                </f:facet>

                <p:ajax event="rowSelect"  update="formGer:formMantenimientos:botones" />
                <p:ajax event="rowUnselect" update="formGer:formMantenimientos:botones" />
                <p:column  headerText="Fecha">
                    <div style="text-align: center; font-size: 12px;" >
                        <h:outputText value="#{man.fecha}" >
                            <f:convertDateTime pattern="dd/MM/yyyy" />
                        </h:outputText>
                    </div>
                </p:column>
                <p:column  headerText="Vehiculo">
                    <div style="text-align: center; font-size: 12px;" >
                        <h:outputText value="#{man.idVehiculo.marca} #{man.idVehiculo.modelo}" />
                    </div>
                </p:column>
                <p:column  headerText="Patente">
                    <div style="text-align: center; font-size: 12px;" >
                        <h:outputText value="#{man.idVehiculo.patente}" />
                    </div>
                </p:column>
                <p:column  headerText="DescripciÃ³n">
                    <div style="text-align: center; font-size: 12px;" >
                        <h:outputText value="#{man.descripcion}" />
                    </div>
                </p:column>
                <p:column  headerText="Lugar">
                    <h:outputText value="#{man.lugar}" />
                </p:column>
                <p:column  headerText="Presupuesto">
                    <h:outputText value="#{man.presupuesto}" >
                        <f:convertNumber type="currency" currencySymbol="$" />
                    </h:outputText>
                </p:column>
                <p:column  headerText="Autorizado">
                    <h:outputText value="#{man.idAutorizacion==null?'NO':'SI'}" />
                </p:column>
                <p:column  headerText="Pagado">
                    <h:outputText value="#{man.idEgreso==null?'NO':'SI'}" />
                </p:column>
                <p:column  headerText="Factura">
                    <h:outputText value="#{man.factura}" />
                </p:column>
                

            </p:dataTable> 
            <p:outputPanel id="botones">
                <p:commandButton  value="Presupuestar" disabled="#{!mantenimientosBean.puedePresupuestar()}" ajax="true" update="formGer:formMantenimientos"  oncomplete="PF('dlgMantenimiento').show();" />

                <p:commandButton value="Autorizar" disabled="#{!mantenimientosBean.puedeAutorizar()}" ajax="false" update="formGer:formMantenimientos" actionListener="#{mantenimientosBean.autorizarMantenimiento()}" />

                <p:commandButton value="Registrar Egreso" disabled="#{!mantenimientosBean.puedeRegistrarPago()}" ajax="true" update="formGer:formMantenimientos"  oncomplete="PF('dlgMantenimientoEgreso').show();" />
            </p:outputPanel>

            <p:dialog id="dlgAgregarPresupuesto" header="Presupuestar Mantenimiento" widgetVar="dlgMantenimiento" modal="false"
                      resizable="false" height="220" width="450" style="font-size: 12px;">
                <p:outputPanel id="presupuestoMantenimientos" >
                    <h:panelGrid columns="2">

                        <p:outputLabel value="Presupuesto"  />
                        <p:inputNumber  value="#{mantenimientosBean.valor}" maxValue="999999" />
                        <p:outputLabel value="Lugar"  />
                        <p:inputText value="#{mantenimientosBean.lugar}" maxlength="50" size="50"/>
                    </h:panelGrid> 
                    <br/>
                    <div style="text-align: right;">
                        <p:commandButton   ajax="false"  value="Guardar"   action="#{mantenimientosBean.guardarPresupuesto()}" />
                    </div>
                </p:outputPanel>
            </p:dialog>

            <p:dialog id="dlgAgregarEgreso" header="Mantenimiento" widgetVar="dlgMantenimientoEgreso" modal="false"
                      resizable="false" height="100" width="250" style="font-size: 12px;">
                <p:outputPanel id="egresoMantenimientos" >
                    <h:panelGrid columns="2">

                        <p:outputLabel value="Factura"  />
                        <p:inputText   value="#{mantenimientosBean.factura}" />

                    </h:panelGrid> 
                    <br/>
                    <div style="text-align: right;">
                        <p:commandButton   ajax="false"  value="Guardar"   action="#{mantenimientosBean.guardarEgreso()}" />
                    </div>
                </p:outputPanel>
            </p:dialog>

        </h:form>
    </ui:define>


</ui:composition>